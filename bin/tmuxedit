#!/bin/bash

SCRIPT_DIR=$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" &> /dev/null && pwd)

#nohup $TERM >&/dev/null &
#disown %1 # hope it's the first :)

echo "Trying to open the following files:"
echo "$@" | column -c 100
if ! "$SCRIPT_DIR/prompt-yn" -y "Are you sure?"; then
    exit 0
fi

MODE="$1"
shift

TMUX_SESSION=false
if [[ ! -z "$TMUX" ]]; then
    TMUX_SESSION=true
fi

for FILE in $@; do
    BASENAME=$(basename $FILE)
    COMMAND="$EDITOR $FILE"
    if [[ "$MODE" == "window" ]]; then
        if ! $TMUX_SESSION; then
            tmux new-session -d -n "$BASENAME"
            TMUX_SESSION=true
        else
            tmux new-window -n "$BASENAME"
        fi
    else
        tmux split-window -c "#(pane_current_path)"
    fi
    tmux send-keys "$COMMAND" Enter
done

#tmux select-window -t "$1" #"editsession:shell"

if [[ "$MODE" == "window" ]]; then
    bash -c "sleep 1 && tmux choose-tree -Zw" &
    tmux attach-session -d
fi

